<!--
  Temporary fix for YouTube player on iOS resulting a 153 error.
  https://medium.com/@davidvesely.cz/fixing-youtube-error-153-in-ios-capacitor-apps-a-simple-proxy-solution-5807d3df83d5
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
  <meta name="referrer" content="strict-origin-when-cross-origin">
  <title>YouTube Video</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; overflow: hidden; background: #000; }
    #player { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: 0; }
  </style>
</head>
<body>
  <iframe
    id="player"
    allowfullscreen
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    referrerpolicy="strict-origin-when-cross-origin"
  ></iframe>
  <script>
    (function() {
      const pathSegments = window.location.pathname.split('/');
      const videoId = pathSegments[pathSegments.length - 1] || '';

      if (!videoId) {
        document.body.innerHTML = '<div style="color: white; padding: 20px; text-align: center;">Error: Missing video ID in the URL</div>';
        return;
      }

      const urlParams = new URLSearchParams(window.location.search);
      const autoplay = urlParams.get('autoplay') || '0';
      const loop = urlParams.get('loop') || '0';
      const mute = urlParams.get('mute') || '0';
      const playlist = urlParams.get('playlist') || videoId;
      const controls = urlParams.get('controls') || '1';
      const rel = urlParams.get('rel') || '0';
      const modestbranding = urlParams.get('modestbranding') || '1';
      const playsinline = urlParams.get('playsinline') || '1';

      const embedParams = new URLSearchParams({
        autoplay,
        controls,
        rel,
        modestbranding,
        playsinline,
        enablejsapi: '1',
        origin: window.location.origin
      });

      let origin;
      try {
        origin = document.referrer ? new URL(document.referrer).origin : undefined;
      } catch {
        origin = undefined;
      }

      if (origin) {
        embedParams.append('origin', origin);
      }

      if (loop === '1') {
        embedParams.append('loop', '1');
        embedParams.append('playlist', playlist);
      }

      if (mute === '1') {
        embedParams.append('mute', '1');
      }

      const embedUrl = `https://www.youtube-nocookie.com/embed/${encodeURIComponent(videoId)}?${embedParams.toString()}`;
      document.getElementById('player').src = embedUrl;
    })();
  </script>
</body>
</html>
